<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
  <body>
    <h1>OpenBSD VMM driver</h1>

    <ul id="toc"></ul>

    <p>
    OpenBSD VMM is an OpenBSD hypervisor. It first appeared in
    <a href="http://www.openbsd.org/59.html">OpenBSD 5.9</a>.
    Additional information on OpenBSD VMM could be obtained on
    <a href="http://www.openbsd.org/">www.openbsd.org</a>.
    </p>

    <h2><a id="project">Project Links</a></h2>

    <ul>
      <li>
        The <a href="http://openbsd.org/">OpenBSD</a>
      </li>
    </ul>

    <h2><a id="connections">Connections to OpenBSD VMM driver</a></h2>

    <p>
    The libvirt OpenBSD VMM driver is a single-instance privileged driver. Some
    sample connection URIs are:
    </p>

<pre>
openbsd:///system                     (local access)
openbsd+unix:///system                (local access)
openbsd+ssh://root@example.com/system (remote access, SSH tunnelled)
</pre>

    <h2><a id="notes">Notes on bridged networking</a></h2>

    <p>
    Bridged networking enables a guest domain (ie container) to have its
    network interface connected directly to the host's physical LAN. Before
    this can be used there are a couple of configuration pre-requisites for
    the host OS.
    </p>

    <h3><a id="host">Host network devices</a></h3>

    <p>
    One or more of the physical devices must be attached to a bridge. The
    process for this varies according to the operating system in use, so
    for up to date notes consult the <a href="http://wiki.libvirt.org">Wiki</a>
    or your operating system's networking documentation. The basic idea is
    that the host OS should end up with a bridge device "br0" containing a
    physical device "eth0", or a bonding device "bond0".
    </p>

    <h3><a id="tools">OpenVZ tools configuration</a></h3>

    <p>
    OpenVZ releases later than 3.0.23 ship with a standard network device
    setup script that is able to setup bridging, named
    <code>/usr/sbin/vznetaddbr</code>. For releases prior to 3.0.23, this
    script must be created manually by the host OS administrator. The
    simplest way is to just download the latest version of this script
    from a newer OpenVZ release, or upstream source repository. Then
    a generic configuration file <code>/etc/vz/vznet.conf</code>
    must be created containing
    </p>

<pre>
#!/bin/bash
EXTERNAL_SCRIPT="/usr/sbin/vznetaddbr"
</pre>

    <p>
    The host OS is now ready to allow bridging of guest containers, which
    will work whether the container is started with libvirt, or OpenVZ
    tools.
    </p>


    <h2><a id="example">Example guest domain XML configuration</a></h2>

    <p>
    The current libvirt OpenVZ driver has a restriction that the
    domain names must match the OpenVZ container VEID, which by
    convention start at 100, and are incremented from there. The
    choice of OS template to use inside the container is determined
    by the <code>filesystem</code> tag, and the template source name
    matches the templates known to OpenVZ tools.
    </p>

<pre>
&lt;domain type='vmm' id='104'&gt;
  &lt;name&gt;104&lt;/name&gt;
  &lt;uuid&gt;86c12009-e591-a159-6e9f-91d18b85ef78&lt;/uuid&gt;
  &lt;vcpu&gt;3&lt;/vcpu&gt;
  &lt;os&gt;
    &lt;type&gt;exe&lt;/type&gt;
    &lt;init&gt;/sbin/init&lt;/init&gt;
  &lt;/os&gt;
  &lt;devices&gt;
    &lt;filesystem type='template'&gt;
      &lt;source name='fedora-9-i386-minimal'/&gt;
      &lt;target dir='/'/&gt;
    &lt;/filesystem&gt;
    &lt;interface type='bridge'&gt;
      &lt;mac address='00:18:51:5b:ea:bf'/&gt;
      &lt;source bridge='br0'/&gt;
      &lt;target dev='veth101.0'/&gt;
    &lt;/interface&gt;
  &lt;/devices&gt;
&lt;/domain&gt;
</pre>

  </body>
</html>
